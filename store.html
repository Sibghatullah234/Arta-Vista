<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArtaVista Store</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; color: #333; }
    .dark-mode { background: #222; color: #fff; }
    header { display: flex; justify-content: space-between; align-items: center; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 8px; display: inline-block; width: 200px; background: white; }
    .product img { width: 100%; height: 150px; object-fit: cover; }
    .cart { margin-top: 20px; padding: 15px; background: white; border-radius: 8px; }
    button { padding: 8px 12px; margin-top: 8px; cursor: pointer; }
</style>
</head>
<body>
<header>
    <h1>ArtaVista Store</h1>
    <button id="darkModeToggle">ðŸŒ™ Toggle Dark Mode</button>
</header>

<input type="text" id="searchBar" placeholder="Search products..." style="width: 100%; padding: 10px; margin: 10px 0;">

<div id="products"></div>

<div class="cart">
    <h2>Your Cart</h2>
    <ul id="cartList"></ul>
    <p><strong>Total: â‚¹<span id="total">0</span></strong></p>
    <button id="checkoutBtn">Checkout</button>
</div>

<script>
let products = JSON.parse(localStorage.getItem('products')) || [];
let cart = [];

// Load products into store
function displayProducts() {
    const container = document.getElementById('products');
    container.innerHTML = '';

    if (products.length === 0) {
        container.innerHTML = '<p>No products available. Add products from Manager.</p>';
        return;
    }

    products.forEach((p, index) => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
            <img src="${p.image || ''}" alt="Product Image">
            <h3>${p.name}</h3>
            <p>â‚¹${p.price}</p>
            <button onclick="addToCart(${index})">Add to Cart</button>
        `;
        container.appendChild(div);
    });
}

// Add to cart function
function addToCart(index) {
    const product = products[index];
    const existing = cart.find(item => item.name === product.name);

    if (existing) {
        existing.qty++;
    } else {
        cart.push({ name: product.name, price: product.price, qty: 1 });
    }

    updateCart();
}

// Update cart display
function updateCart() {
    const cartList = document.getElementById('cartList');
    cartList.innerHTML = '';
    let total = 0;

    cart.forEach((item, i) => {
        total += item.price * item.qty;
        const li = document.createElement('li');
        li.innerHTML = `${item.name} x ${item.qty} - â‚¹${item.price * item.qty} 
            <button onclick="removeFromCart(${i})">Remove</button>`;
        cartList.appendChild(li);
    });

    document.getElementById('total').innerText = total;
}

// Remove item from cart
function removeFromCart(i) {
    cart.splice(i, 1);
    updateCart();
}

// Checkout and save order
document.getElementById('checkoutBtn').addEventListener('click', () => {
    if (cart.length === 0) {
        alert('Cart is empty!');
        return;
    }

    const name = prompt('Enter your name:');
    const address = prompt('Enter your address:');
    const phone = prompt('Enter your phone number:');

    if (!name || !address || !phone) {
        alert('All fields are required!');
        return;
    }

    const order = {
        customer: { name, address, phone },
        items: cart,
        total: document.getElementById('total').innerText
    };

    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    alert('Order placed successfully!');

    // Printable invoice
    let invoice = `<h1>Invoice</h1>
                   <p>Name: ${name}</p>
                   <p>Address: ${address}</p>
                   <p>Phone: ${phone}</p>
                   <h3>Items:</h3>
                   <ul>`;
    cart.forEach(item => {
        invoice += `<li>${item.name} x ${item.qty} - â‚¹${item.price * item.qty}</li>`;
    });
    invoice += `</ul><p><strong>Total: â‚¹${document.getElementById('total').innerText}</strong></p>`;
    const w = window.open('', 'Invoice');
    w.document.write(invoice);
    w.print();

    cart = [];
    updateCart();
});

// Search filter
document.getElementById('searchBar').addEventListener('input', (e) => {
    const value = e.target.value.toLowerCase();
    products = JSON.parse(localStorage.getItem('products')) || [];
    products = products.filter(p => p.name.toLowerCase().includes(value));
    displayProducts();
});

// Dark Mode toggle
document.getElementById('darkModeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('store_dark', document.body.classList.contains('dark-mode'));
});

if (localStorage.getItem('store_dark') === 'true') {
    document.body.classList.add('dark-mode');
}

displayProducts();
</script>
</body>
</html>
